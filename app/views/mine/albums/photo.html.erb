
<div class="title_btn clearfix">
  <h2><%= @user.username %>的相册-<%= @album.intro %> <span class="count_b">(共<%= @album.photos_num %>张)</span></h2>
</div>
<div id="leftcol" class="mr50">
  <div class="photo_detail">
    <div class="pn clearfix">
      <a href="<%= url_for :action => 'photo', :album_id => @album.id, :index => @index + 1%>" class="button_gray float_r"><span>下一张</span></a>
      <a href="<%= url_for :action => 'photo', :album_id => @album.id, :index => @index - 1%>" class="button_gray float_r mr5"><span>上一张</span></a>
      <a href="<%= url_for :action => 'show', :album_id => @album.id %>" class="button_gray float_l"><span>返回该相册</span></a>
      第<%= @index + 1 %>张/共<%= @album.photos_num %>张
    </div>
    <div class="photo_detail_pic">
      <%= image_tag @photo.image_url :large %>
    </div>
    <div class="description"><%= @photo.intro %></div>
    <div class="photo_info clearfix">
      <span class="float_r">分享到</span>
      <span class="icon_like float_r mr10">(13)</span>
      <%= @photo.viewed_num %>浏览 | <%= @photo.commented_num %>评论
    </div>
  </div>
  <div class="comment">
    <a href="#add_comment" onclick="$('#photo_comment_comment').focus();" class="button_gray float_r"><span>添加评论</span></a><h3>评论</h3>
    <div class="comment_list">
      <ul>
        <% @photo_comments.each do |comment| %>
        <li class="clearfix">
          <div class="user_img">
            <a href="#">
              <% if comment.user.avatar.present? %>
              <%= image_tag comment.user.avatar.image_url( :thumb ), :width => 50, :height => 50 %>
              <% else %>
              <img src="/images/test/user_img50.jpg" width="50" height="50" alt="user name" />
              <% end %>
            </a>
          </div>
          <div class="comment_main">
            <div class="name_time_score">
              <div class="mr5">
                <a href="#" id="comment_user_<%= comment.id %>"><%= comment.user.username %> </a> 
                <span class="time"><%= comment.created_at.strftime '%Y-%m-%d'%></span>
                <a href="javascript:;" onclick="reply_to(<%= comment.id %>);">回复</a>
              </div>
            </div>
            <% if comment.reply_id > 0 %>
            <div class="reply_content"><%= comment.reply_to.comment %></div>
            <% end %>
            <div class="comment_content" id="comment_content_<%= comment.id %>"><%= comment.comment %></div>
          </div>
          <div class="clear"></div>
        </li>
        <% end %>
      </ul>
      <div class="comment_form mt20">
        <%= form_for @photo_comment, :url => '/users/albums/photo_comment' do |f| %>
        <input type="hidden" name="photo_comment[photo_id]" value="<%= @photo.id %>" />
        <%= f.hidden_field :reply_id %>
        <div class="user_img">
            <% if current_user.avatar.present? %>
            <%= image_tag current_user.avatar.image_url( :thumb ), :width => 50, :height => 50 %>
            <% else %>
            <img src="/images/test/user_img50.jpg" width="50" height="50" alt="user name" />
            <% end %>
        </div>
        <div class="comment_input">
          <a name="add_comment" id="add_comment"></a>
          <div style="display: none;" id="reply_comment_content" class="reply_content2">
          </div>
          <%= f.text_area :comment, :class => 'comment' %>
          <a href="javascript:;" onclick="$(this).parent().parent().submit();" class="button_gray float_l mt10"><span>OK, 加上去</span></a>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<div id="rightcol" class="other_content">
  <h3><%= @user.username %>的其他相册</h3>
  <ul class="other_album">
    <% @top_albums.each do |album| %>
    <li class="clearfix">
      <div class="pic">
        <a href="<%= url_for :action => 'show', :album_id => album.id %>">
          <% if album.cover.present? %>
          <%= image_tag album.cover.image_url( :thumb ), :width => 90, :height => 90 %>
          <% else %>
          <img src="/assets/base/test/album_cover5_s.jpg" width="90" height="90" />
          <% end %>
        </a>
      </div>
      <div class="album_info">
        <h3><a href="<%= url_for :action => 'show', :album_id => album.id %>"><%= album.intro %></a></h3>
        <%= album.photos_num %>张照片<br/><%= album.updated_at.strftime '%Y-%m-%d'%> 更新
      </div>
    </li>
    <% end %>
    <div class="clear"></div>
  </ul>
</div>
<div class="clear"></div>
<script type="text/javascript">
function reply_to( comment_id ){
  $('#reply_comment_content').css('display' , 'block');
  $('#reply_comment_content').html( $('#comment_content_' + comment_id).text() + ' <span class="reply_to">by '+ $('#comment_user_'+comment_id).text() +'</span>');
  $('#photo_comment_reply_id').val(comment_id);
};
</script>