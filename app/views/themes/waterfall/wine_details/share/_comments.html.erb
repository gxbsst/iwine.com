<div class="wp_space_line ptb30">
	<div class="title_btn">
		<a href="#" class="btn_gray float_r"><span>添加评论</span></a>
		<% unless params[:controller] == "wine_details/comments" %>
		<h2>
		  评论
		  <span class="font12 more">
		    <%= link_to "(#{@wine_detail.comments_count}条...)", wine_comments_path(@wine_detail.id)%>
		  </span>
		</h2>
		<% end %>
		<div class="clear"></div>
	</div>
	<ul class="comment_list clearfix">

		<% @comments.each do |comment| %>	
		<li>
			<div class="userpic">
				 <%= link_to_user comment.user, user_path(comment.user, :trailing_slash => true), :with_avatar => true, :avatar_version => :middle %>
			</div>
			<div class="main">
				<div class="username">
					<%= link_to_user comment.user, user_path(comment.user, :trailing_slash => true ) %>
					<span class="date"> <%= comment.created_at.to_s(:normal) %></span><!--<span class="control"><a href="#">回复</a> | <a href="#">删除</a></span>-->
					<%=  star_rate_tag(comment.point.to_i) %>
				</div>
				<div class="content"><%= comment.body %></div>
				<div class="userful">
					<%= link_to  vote_wine_comment_path(@wine_detail.id, comment.id), :remote => true, :class => "ajax"  do %>
		        有用(<span class="likes_count"><%=comment.votes_count %></span>)
		      <% end %>
					| 
					<%= link_to  reply_wine_comment_path(@wine_detail.id, comment.id),
		          :remote => true,
		          :class => "ajax reply_comment_button",
		          :id => "reply_#{comment.id}" do %>
		      回复<span class="reply_comment_count">(<%= comment.children.size %>)</span>
		      <% end %>
				</div>
				
				<div id="reply_comment_<%= comment.id %>" class="replybox" style="display: none">
			  </div>
			
				
				
			</div>
			<div class="clear"></div>
		</li>
		<% end %>
		</ul>
		<div class="clear"></div>
	</div>
	


<script type="text/javascript">
  $(document).ready(function(){
  // "有用" 成功时，更新有用的数量
  $(".vote a").bind("ajax:success", function(event, data, textStatus, jqXHR){
    $(this).find("span.likes_count").text(data);
  });
  // 评论按钮
  $("a.reply_comment_button").click(function(){
  // $(".reply_comment_outer").html("");
  });
  $("a.reply_comment_button").bind("ajax:success", function(event, data, textStatus, jqXHR){
  $comment_outer = $(this).parent().parent().children(".replybox");
  if($comment_outer.is(":hidden")){
  	$comment_outer.slideDown("slow");
  }
  else
  {
  	$comment_outer.slideUp("slow");
  }
  });


  });
</script>
